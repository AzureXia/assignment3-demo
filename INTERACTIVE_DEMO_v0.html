<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinical Research Pipeline Demo</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #262730;
            background-color: #ffffff;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        .main-header {
            font-size: 2.5rem;
            font-weight: bold;
            color: #1f77b4;
            text-align: center;
            margin: 2rem 0;
        }
        
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 250px;
            height: 100vh;
            background-color: #f0f2f6;
            padding: 1rem;
            overflow-y: auto;
            border-right: 1px solid #e6eaf1;
        }
        
        .sidebar h3 {
            color: #1f77b4;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }
        
        .sidebar-nav {
            list-style: none;
        }
        
        .sidebar-nav li {
            margin-bottom: 0.5rem;
        }
        
        .sidebar-nav button {
            width: 100%;
            text-align: left;
            padding: 0.5rem;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 0.25rem;
            transition: background-color 0.2s;
        }
        
        .sidebar-nav button:hover {
            background-color: #e6eaf1;
        }
        
        .sidebar-nav button.active {
            background-color: #1f77b4;
            color: white;
        }
        
        .main-content {
            margin-left: 270px;
            padding: 1rem;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .pipeline-steps {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .pipeline-step {
            background-color: #f0f2f6;
            padding: 1rem;
            border-radius: 10px;
            border-left: 4px solid #1f77b4;
        }
        
        .pipeline-step h4 {
            color: #262730;
            margin-bottom: 0.5rem;
        }
        
        .pipeline-step p {
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        
        .agent-status {
            background-color: #e8f5e8;
            padding: 0.5rem;
            border-radius: 5px;
            color: #2e8b57;
            font-weight: bold;
            font-size: 0.8rem;
        }
        
        .optional-step {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        
        .optional-step .agent-status {
            background-color: #ffc107;
            color: #333;
        }
        
        .metrics-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .metric-card {
            background-color: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
            border: 1px solid #e6eaf1;
        }
        
        .metric-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #1f77b4;
            margin-bottom: 0.5rem;
        }
        
        .metric-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .metric-delta {
            font-size: 0.8rem;
            color: #28a745;
            margin-top: 0.25rem;
        }
        
        .chart-container {
            background-color: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 1rem 0;
            border: 1px solid #e6eaf1;
        }
        
        .code-block {
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.25rem;
            font-family: 'Courier New', Monaco, monospace;
            margin: 1rem 0;
            overflow-x: auto;
            position: relative;
        }
        
        .copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: #4a5568;
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            cursor: pointer;
            font-size: 0.75rem;
        }
        
        .copy-btn:hover {
            background-color: #2d3748;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .feature-card {
            background-color: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid #e6eaf1;
        }
        
        .feature-card h4 {
            color: #1f77b4;
            margin-bottom: 0.5rem;
        }
        
        .feature-card ul {
            list-style: none;
            padding-left: 0;
        }
        
        .feature-card li {
            padding: 0.25rem 0;
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .feature-card li::before {
            content: "â€¢ ";
            color: #1f77b4;
            font-weight: bold;
        }
        
        .info-box {
            background-color: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 0.25rem;
            padding: 1rem;
            margin: 1rem 0;
            color: #1565c0;
        }
        
        .footer {
            text-align: center;
            padding: 2rem 0;
            color: #666;
            border-top: 1px solid #e6eaf1;
            margin-top: 3rem;
            background-color: #f8f9fa;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            .main-content {
                margin-left: 0;
            }
            .pipeline-steps {
                grid-template-columns: 1fr;
            }
            .metrics-container {
                grid-template-columns: repeat(2, 1fr);
            }
            .feature-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h3>Clinical Research Pipeline</h3>
        <ul class="sidebar-nav">
            <li><button class="active" onclick="showTab('overview')">Pipeline Overview</button></li>
            <li><button onclick="showTab('metrics')">Metrics Dashboard</button></li>
            <li><button onclick="showTab('commands')">Interactive Commands</button></li>
            <li><button onclick="showTab('integration')">Agent Integration</button></li>
            <li><button onclick="showTab('temporal')">Temporal Analysis</button></li>
            <li><button onclick="showTab('journal')">Journal Analysis</button></li>
            <li><button onclick="showTab('knowledge')">Knowledge Base</button></li>
        </ul>
        
        <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #e6eaf1;">
            <h4 style="color: #1f77b4; margin-bottom: 1rem;">Quick Stats</h4>
            <div style="margin-bottom: 0.5rem;">
                <strong>Total Papers:</strong> 2,847
            </div>
            <div style="margin-bottom: 0.5rem;">
                <strong>QA Pairs:</strong> 4,290
            </div>
            <div style="margin-bottom: 0.5rem;">
                <strong>Split Fields:</strong> 1,634
            </div>
        </div>
    </div>
    
    <div class="main-content">
        <div class="main-header">Clinical Research Knowledge Base Pipeline</div>
        
        <div id="overview" class="tab-content active">
            <div class="pipeline-steps">
                <div class="pipeline-step">
                    <h4>Step 1: Retrieve</h4>
                    <p>Agent retrieves papers from PubMed using intelligent keyword matching</p>
                    <div class="agent-status">Retrieval Agent</div>
                </div>
                <div class="pipeline-step">
                    <h4>Step 2: Classify</h4>
                    <p>AI agent filters relevant depression/anxiety research</p>
                    <div class="agent-status">Classification Agent</div>
                </div>
                <div class="pipeline-step">
                    <h4>Step 3: Extract</h4>
                    <p>Schema extraction agent identifies key clinical data</p>
                    <div class="agent-status">Extraction Agent</div>
                </div>
                <div class="pipeline-step optional-step">
                    <h4>Optional Steps</h4>
                    <p><strong>3b:</strong> Field splitting<br><strong>4:</strong> QA generation</p>
                    <div class="agent-status">Optional Agents</div>
                </div>
            </div>
            
            <div class="metrics-container">
                <div class="metric-card">
                    <div class="metric-value">2,847</div>
                    <div class="metric-label">Papers Retrieved</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">1,203</div>
                    <div class="metric-label">Relevant Papers</div>
                    <div class="metric-delta">42.2% pass rate</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">856</div>
                    <div class="metric-label">Data Extracted</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">634</div>
                    <div class="metric-label">Fields Split</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">4,290</div>
                    <div class="metric-label">QA Pairs</div>
                </div>
            </div>
            
            <div class="chart-container">
                <h3>Agent Pipeline Data Flow</h3>
                <div id="flowChart" style="height: 400px;"></div>
            </div>
        </div>
        
        <div id="metrics" class="tab-content">
            <div class="chart-container">
                <h3>Research Papers by Publication Year</h3>
                <div id="yearChart" style="height: 400px;"></div>
            </div>
        </div>
        
        <div id="commands" class="tab-content">
            <h3>Interactive Command Builder</h3>
            
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>Core Pipeline</h4>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCommand(this)">Copy</button>
python run.py core \
  --keywords "depression OR anxiety" \
  --start-year 2020 \
  --end-year 2024 \
  --sample-per-year 100
                    </div>
                </div>
                
                <div class="feature-card">
                    <h4>Full Pipeline</h4>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCommand(this)">Copy</button>
python run.py pipeline \
  --keywords "depression OR anxiety" \
  --start-year 2020 \
  --end-year 2024
                    </div>
                </div>
                
                <div class="feature-card">
                    <h4>Individual Steps</h4>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCommand(this)">Copy</button>
python run.py extract \
  --input outputs/step2_filtered.csv

python run.py qa \
  --input outputs/step3_extracted.csv
                    </div>
                </div>
            </div>
        </div>
        
        <div id="integration" class="tab-content">
            <h3>Agent Integration & Export</h3>
            
            <div class="info-box">
                This pipeline is designed as an <strong>exportable agent</strong> for integration with other AI systems.
            </div>
            
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>Integration Workflow</h4>
                    <ul>
                        <li>Assignment 3 Agent (this pipeline)</li>
                        <li>Retrieves papers from PubMed</li>
                        <li>Filters for clinical relevance</li>
                        <li>Extracts structured clinical data</li>
                        <li>Outputs: step3_extracted.csv</li>
                        <li>Assignment 4 Agent (population analysis)</li>
                        <li>Imports Assignment 3 clinical data</li>
                        <li>Performs population-stratum analysis</li>
                    </ul>
                </div>
                
                <div class="feature-card">
                    <h4>Available Methods</h4>
                    <ul>
                        <li>run_core_pipeline() - Run 3 essential steps</li>
                        <li>run_full_pipeline() - Run all 5 steps</li>
                        <li>get_extracted_data() - Get clinical data</li>
                        <li>get_qa_bank() - Get Q&A knowledge base</li>
                        <li>export_data_for_agent() - Export in various formats</li>
                        <li>get_pipeline_status() - Check outputs</li>
                        <li>get_summary_stats() - Get statistics</li>
                    </ul>
                </div>
                
                <div class="feature-card">
                    <h4>Integration Benefits</h4>
                    <ul>
                        <li>Reusability: Single agent, multiple consumers</li>
                        <li>Standardized data output</li>
                        <li>Consistent processing</li>
                        <li>Multiple export formats</li>
                        <li>Configurable parameters</li>
                        <li>Optional step control</li>
                        <li>Programmatic execution</li>
                        <li>API integration ready</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div id="temporal" class="tab-content">
            <div class="chart-container">
                <h3>Temporal Research Trends</h3>
                <div id="temporalChart" style="height: 400px;"></div>
            </div>
        </div>
        
        <div id="journal" class="tab-content">
            <div class="chart-container">
                <h3>Publication Source Analysis</h3>
                <div id="journalChart" style="height: 500px;"></div>
            </div>
        </div>
        
        <div id="knowledge" class="tab-content">
            <h3>AI-Generated Knowledge Base</h3>
            
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>Sample Q&A Pair 1</h4>
                    <p><strong>Q:</strong> What are the primary risk factors for clinical depression in adolescents?</p>
                    <p><strong>A:</strong> Key risk factors include family history of depression, chronic medical conditions, substance abuse, social isolation, academic stress, and traumatic life events. Research shows that adolescents with multiple risk factors have significantly higher rates of developing clinical depression.</p>
                </div>
                
                <div class="feature-card">
                    <h4>Sample Q&A Pair 2</h4>
                    <p><strong>Q:</strong> How effective are SSRIs in treating anxiety disorders?</p>
                    <p><strong>A:</strong> SSRIs show 60-70% response rates in treating generalized anxiety disorder and panic disorder. Studies indicate that sertraline and escitalopram demonstrate particularly strong efficacy profiles with manageable side effect profiles in most patients.</p>
                </div>
                
                <div class="feature-card">
                    <h4>Sample Q&A Pair 3</h4>
                    <p><strong>Q:</strong> What cognitive behavioral therapy techniques are most effective for depression?</p>
                    <p><strong>A:</strong> Behavioral activation, cognitive restructuring, and problem-solving therapy show the strongest evidence base. Meta-analyses indicate that structured CBT protocols with homework assignments and thought records achieve superior outcomes compared to unstructured approaches.</p>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <div style="text-align: center; color: #666;">
                Powered by Multi-Agent AI Pipeline | Clinical Depression & Anxiety Research<br>
                <strong>Flexible Architecture:</strong> Core + Optional Agents | User-Configurable Steps
            </div>
        </div>
    </div>
    
    <script>
        function showTab(tabName) {
            // Hide all tab contents
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.sidebar-nav button');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Load charts for specific tabs
            if (tabName === 'overview') {
                setTimeout(() => createFlowChart(), 100);
            } else if (tabName === 'metrics') {
                setTimeout(() => createYearChart(), 100);
            } else if (tabName === 'temporal') {
                setTimeout(() => createTemporalChart(), 100);
            } else if (tabName === 'journal') {
                setTimeout(() => createJournalChart(), 100);
            }
        }
        
        function copyCommand(button) {
            const commandBlock = button.parentElement;
            const text = commandBlock.textContent.replace('Copy', '').trim();
            navigator.clipboard.writeText(text).then(() => {
                button.textContent = 'Copied!';
                setTimeout(() => button.textContent = 'Copy', 2000);
            });
        }
        
        function createFlowChart() {
            const data = [{
                type: "funnel",
                y: ["Retrieved", "Filtered", "Extracted", "Split (Optional)", "QA Generated (Optional)"],
                x: [2847, 1203, 856, 634, 290],
                textinfo: "value+percent initial",
                marker: {
                    color: ["#1f77b4", "#ff7f0e", "#2ca02c", "#ffc107", "#d62728"]
                },
                connector: {
                    line: {
                        color: "royalblue",
                        dash: "dot",
                        width: 3
                    }
                }
            }];
            
            const layout = {
                title: "",
                font: {size: 14},
                margin: {t: 20, b: 50, l: 100, r: 100}
            };
            
            Plotly.newPlot('flowChart', data, layout, {responsive: true});
        }
        
        function createYearChart() {
            const years = [2020, 2021, 2022, 2023, 2024];
            const counts = [342, 487, 623, 789, 606];
            
            const data = [{
                x: years,
                y: counts,
                type: 'bar',
                marker: {
                    color: counts,
                    colorscale: 'Blues'
                }
            }];
            
            const layout = {
                title: "",
                xaxis: {title: 'Publication Year'},
                yaxis: {title: 'Number of Papers'},
                margin: {t: 20, b: 50, l: 60, r: 30}
            };
            
            Plotly.newPlot('yearChart', data, layout, {responsive: true});
        }
        
        function createTemporalChart() {
            // Same as year chart but in temporal tab
            createYearChart();
            // Move the chart to temporal container
            const chartDiv = document.getElementById('yearChart');
            const temporalDiv = document.getElementById('temporalChart');
            if (chartDiv && temporalDiv && chartDiv.innerHTML) {
                temporalDiv.innerHTML = chartDiv.innerHTML;
                Plotly.Plots.resize('temporalChart');
            }
        }
        
        function createJournalChart() {
            const journals = [
                'Nature Medicine',
                'JAMA Psychiatry', 
                'Biological Psychiatry',
                'American Journal of Psychiatry',
                'Journal of Affective Disorders',
                'Depression and Anxiety',
                'Psychological Medicine',
                'Journal of Clinical Psychiatry',
                'Lancet Psychiatry',
                'PLOS ONE'
            ];
            const papers = [89, 67, 54, 43, 38, 35, 29, 27, 24, 22];
            const impact_factors = [87.2, 19.2, 13.6, 19.2, 6.5, 6.4, 5.9, 4.2, 30.8, 3.7];
            
            const data = [{
                x: papers,
                y: journals,
                type: 'bar',
                orientation: 'h',
                marker: {
                    color: impact_factors,
                    colorscale: 'RdYlBu_r',
                    colorbar: {
                        title: 'Impact Factor'
                    }
                },
                hovertemplate: '<b>%{y}</b><br>Papers: %{x}<br>Impact Factor: %{marker.color:.1f}<extra></extra>'
            }];
            
            const layout = {
                title: "",
                xaxis: {title: 'Number of Papers'},
                yaxis: {title: 'Journal'},
                margin: {t: 20, b: 50, l: 200, r: 100}
            };
            
            Plotly.newPlot('journalChart', data, layout, {responsive: true});
        }
        
        // Initialize default charts
        document.addEventListener('DOMContentLoaded', function() {
            createFlowChart();
        });
    </script>
</body>
</html>
